# Telegram Web App Setup –¥–ª—è Mluv.Me

**–¶–µ–ª—å**: –°–¥–µ–ª–∞—Ç—å Web UI –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø—Ä—è–º–æ –≤ Telegram —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Menu

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Telegram Web App?

Telegram Web App (Mini App) - —ç—Ç–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ Telegram** –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –±—Ä–∞—É–∑–µ—Ä.

**–ü—Ä–∏–º–µ—Ä—ã**:
- Chatty English Tutor - –∫–Ω–æ–ø–∫–∞ Menu –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- Notcoin, Hamster Combat –∏ –¥—Ä—É–≥–∏–µ –∏–≥—Ä—ã
- Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –±–æ—Ç–æ–≤ –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ BotFather

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ BotFather

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ **@mluvme_bot** (–∏–ª–∏ –∫–∞–∫ –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è)

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Menu Button

1. –í—ã–±–µ—Ä–∏—Ç–µ **Bot Settings**
2. –í—ã–±–µ—Ä–∏—Ç–µ **Menu Button**
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ:
   - **Button Text**: `Open App` –∏–ª–∏ `–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ` –∏–ª–∏ `üéì –£—á–∏—Ç—å —á–µ—à—Å–∫–∏–π`
   - **URL**: `https://mluvme-production.up.railway.app`

### 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Web App –∫–Ω–æ–ø–∫–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

–ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏ —Å Web App –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞.

## üíª –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥ –±–æ—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Menu Button (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ BotFather, –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –≤ –∫–æ–¥–µ –Ω–µ –Ω—É–∂–Ω–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–∫–∞ Menu –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —á–∞—Ç–∞.

### –í–∞—Ä–∏–∞–Ω—Ç 2: Inline –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å Web UI" –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```python
# bot/handlers/start.py
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, WebAppInfo

def get_web_app_keyboard() -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π Web App."""
    return InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(
                text="üéì –û—Ç–∫—Ä—ã—Ç—å Web UI",
                web_app=WebAppInfo(url="https://mluvme-production.up.railway.app")
            )
        ],
        [
            InlineKeyboardButton(
                text="‚ÑπÔ∏è –ü–æ–º–æ—â—å",
                callback_data="help"
            )
        ]
    ])

@router.message(CommandStart())
async def command_start_handler(message: Message, api_client: APIClient) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start."""
    telegram_id = message.from_user.id

    user = await api_client.get_user(telegram_id)

    if user:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
        language = user.get("ui_language", "ru")
        await message.answer(
            get_text("already_registered", language),
            reply_markup=get_web_app_keyboard()  # ‚Üê –î–æ–±–∞–≤–∏–ª–∏ –∫–Ω–æ–ø–∫—É!
        )
        return

    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–Ω–æ–ø–∫–∞ –≤ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥

```python
# bot/handlers/commands.py
from aiogram.types import BotCommand, BotCommandScopeDefault

commands = [
    BotCommand(command="start", description="–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É"),
    BotCommand(command="help", description="–ü–æ–º–æ—â—å"),
    BotCommand(command="webapp", description="üéì –û—Ç–∫—Ä—ã—Ç—å Web UI"),
]

# –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞:
await bot.set_my_commands(commands, scope=BotCommandScopeDefault())
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Web UI

Telegram Web App –∏–º–µ–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

### 1. Telegram Web App SDK

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à Next.js `<head>`:

```html
<!-- frontend/app/layout.tsx -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App

```typescript
// frontend/lib/telegram-web-app.ts
export interface TelegramWebApp {
  initData: string;
  initDataUnsafe: {
    user?: {
      id: number;
      first_name: string;
      last_name?: string;
      username?: string;
      language_code?: string;
    };
  };
  ready: () => void;
  expand: () => void;
  close: () => void;
  MainButton: {
    text: string;
    color: string;
    textColor: string;
    isVisible: boolean;
    isActive: boolean;
    show: () => void;
    hide: () => void;
    onClick: (callback: () => void) => void;
  };
}

declare global {
  interface Window {
    Telegram?: {
      WebApp: TelegramWebApp;
    };
  }
}

export const useTelegramWebApp = () => {
  if (typeof window === 'undefined') return null;
  return window.Telegram?.WebApp || null;
};
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

```typescript
// frontend/app/page.tsx
'use client';

import { useEffect } from 'react';
import { useTelegramWebApp } from '@/lib/telegram-web-app';

export default function HomePage() {
  const webApp = useTelegramWebApp();

  useEffect(() => {
    if (webApp) {
      // –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
      webApp.ready();

      // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
      webApp.expand();

      // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const user = webApp.initDataUnsafe.user;
      console.log('Telegram User:', user);

      // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É
      webApp.MainButton.text = '–ù–∞—á–∞—Ç—å —É—Ä–æ–∫';
      webApp.MainButton.show();
      webApp.MainButton.onClick(() => {
        // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ
        router.push('/dashboard/practice');
      });
    }
  }, [webApp]);

  return (
    <div>
      <h1>Mluv.Me - –£—á–∏–º —á–µ—à—Å–∫–∏–π</h1>
      {/* ... */}
    </div>
  );
}
```

## üé® –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥ Telegram

Telegram Web App –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É:

```typescript
const themeParams = webApp?.themeParams;

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–≤–µ—Ç–∞ Telegram
const colors = {
  bg: themeParams?.bg_color || '#ffffff',
  text: themeParams?.text_color || '#000000',
  button: themeParams?.button_color || '#3390ec',
  buttonText: themeParams?.button_text_color || '#ffffff',
};
```

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –õ–æ–∫–∞–ª—å–Ω–æ (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)

Web App —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å HTTPS! –õ–æ–∫–∞–ª—å–Ω—ã–π `http://localhost` **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**.

### 2. –ù–∞ Railway (production)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Menu** (‚ò∞) –≤–æ–∑–ª–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
3. –î–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è Web UI

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

Web App –ø–µ—Ä–µ–¥–∞–µ—Ç `initData` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–í–∞–∂–Ω–æ**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å—å –Ω–∞ backend!

```python
# backend/routers/web_auth.py
import hmac
import hashlib
from urllib.parse import parse_qsl

def validate_telegram_web_app_data(init_data: str, bot_token: str) -> dict:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram Web App."""
    parsed_data = dict(parse_qsl(init_data))

    hash_value = parsed_data.pop('hash', None)
    if not hash_value:
        raise ValueError("No hash in init_data")

    # –°–æ–∑–¥–∞–µ–º check string
    check_string = '\n'.join(f"{k}={v}" for k, v in sorted(parsed_data.items()))

    # –°–æ–∑–¥–∞–µ–º secret key
    secret_key = hmac.new(
        key=b"WebAppData",
        msg=bot_token.encode(),
        digestmod=hashlib.sha256
    ).digest()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
    calculated_hash = hmac.new(
        key=secret_key,
        msg=check_string.encode(),
        digestmod=hashlib.sha256
    ).hexdigest()

    if calculated_hash != hash_value:
        raise ValueError("Invalid hash")

    return parsed_data
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (5 –º–∏–Ω—É—Ç):

1. **BotFather** ‚Üí Menu Button ‚Üí URL: `https://mluvme-production.up.railway.app`

2. **–î–æ–±–∞–≤–∏—Ç—å SDK** –≤ `frontend/app/layout.tsx`:
```typescript
<script src="https://telegram.org/js/telegram-web-app.js"></script>
```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ ‚Üí –Ω–∞–∂–º–∏—Ç–µ Menu

–ì–æ—Ç–æ–≤–æ! Web UI –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ Telegram! üéâ

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Telegram Web Apps](https://core.telegram.org/bots/webapps)
- [Bot API - Web Apps](https://core.telegram.org/bots/api#webapps)
- [–ü—Ä–∏–º–µ—Ä—ã Web Apps](https://github.com/telegram-mini-apps)

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ Backend API —Ä–∞–±–æ—Ç–∞–µ—Ç: `https://mluvme-production.up.railway.app/api/health`
- ‚úÖ Frontend —Å–æ–±—Ä–∞–Ω –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
- ‚úÖ Reverse proxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚è≥ **TODO**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Menu Button –≤ BotFather
- ‚è≥ **TODO**: –î–æ–±–∞–≤–∏—Ç—å Telegram Web App SDK –≤ frontend
- ‚è≥ **TODO**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å initData –Ω–∞ backend

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Menu Button! üöÄ
