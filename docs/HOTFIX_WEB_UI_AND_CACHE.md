# Hotfix: Web UI –∏ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∞—Ç–∞**: 8 –¥–µ–∫–∞–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ

## –ü—Ä–æ–±–ª–µ–º—ã

### 1. Web UI –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: Next.js —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–∞ `localhost:3000`, –Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `--hostname 0.0.0.0` –≤ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ Next.js:

```bash
npm start -- --port ${FRONTEND_PORT:-3000} --hostname 0.0.0.0
```

–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `FRONTEND_PORT=3000` –≤ `env.example`.

### 2. –ö—ç—à–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –•–æ–Ω–∑–∏–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö—ç—à–∏—Ä—É—é—Ç—Å—è –í–°–ï –æ—Ç–≤–µ—Ç—ã –•–æ–Ω–∑–∏–∫–∞, –≤–∫–ª—é—á–∞—è —Ç–µ, —á—Ç–æ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞. –≠—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç.–∫.:
- –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –ö—ç—à –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `backend/services/honzik_personality.py`:

```python
# Cache ONLY the first greeting message (when there's no conversation history)
should_cache = len(conversation_history) == 0

if should_cache:
    # Try to get from cache
    cached_response = await cache_service.get_cached_honzik_response(...)

    # Cache after generation
    await cache_service.cache_honzik_response(...)
```

**–ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è —Ç–µ–ø–µ—Ä—å**:
- ‚úÖ –°–∞–º–æ–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç –•–æ–Ω–∑–∏–∫–∞ (–Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏)
- ‚ùå –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ—Ç–≤–µ—Ç—ã (–µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞)

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **Dockerfile**
   - –î–æ–±–∞–≤–ª–µ–Ω `--hostname 0.0.0.0` –¥–ª—è Next.js

2. **env.example**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `FRONTEND_PORT=3000`

3. **backend/services/honzik_personality.py**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### Railway Environment Variables

–í Railway –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

```bash
FRONTEND_PORT=3000
```

### Deploy

```bash
git add .
git commit -m "fix: web ui hostname and cache first greeting only"
git push
```

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. Web UI –¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
railway logs

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# Starting frontend (Next.js)...
# ‚ñ≤ Next.js 14.2.33
# - Local: http://0.0.0.0:3000
# ‚úì Ready in Xms
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- `https://your-app.railway.app` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `https://your-app.railway.app/api/health` - health check

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Redis:

```bash
railway logs | grep "honzik"

# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–µ—Ç –∫—ç—à–∞):
# honzik_response_generated
# honzik_greeting_cached

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º (–µ—Å—Ç—å –∫—ç—à):
# using_cached_honzik_greeting

# –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è):
# honzik_response_generated (–±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ "Ahoj, jak se m√°≈°?" ‚Üí –∫—ç—à –ø—É—Å—Ç–æ–π
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ –∂–µ "Ahoj, jak se m√°≈°?" ‚Üí –∫—ç—à –Ω–∞–π–¥–µ–Ω
3. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä ‚Üí –∫—ç—à –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)

## –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏

```json
{
  "event": "processing_voice_message",
  "user_id": 540529430
}
{
  "event": "generating_honzik_response",
  "level": "beginner",
  "conversation_history_length": 0
}
{
  "event": "using_cached_honzik_greeting"
}
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏ (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)

```json
{
  "event": "using_cached_honzik_response",
  "conversation_history_length": 5
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—á–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ?

1. **–≠–∫–æ–Ω–æ–º–∏—è OpenAI —Ç–æ–∫–µ–Ω–æ–≤**: –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –æ–¥–Ω–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–∞–∂–µ–Ω**: –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ—Ç–≤–µ—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
3. **–ö–∞—á–µ—Å—Ç–≤–æ**: –•–æ–Ω–∑–∏–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–º–Ω–∏—Ç—å, –æ —á–µ–º –≤—ã –≥–æ–≤–æ—Ä–∏–ª–∏

### –ö–ª—é—á –∫—ç—à–∞

```python
cache_key = f"honzik:{hash}:{level}:{correction_level}:{conversation_style}"
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SHA256 —Ö—ç—à –æ—Ç:
- –¢–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (normalized)
- –£—Ä–æ–≤–Ω—è —á–µ—à—Å–∫–æ–≥–æ
- –£—Ä–æ–≤–Ω—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- –°—Ç–∏–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

### TTL

```python
REDIS_CACHE_TTL_OPENAI=86400  # 24 —á–∞—Å–∞
```

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Redis Stats

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π
redis-cli
> KEYS honzik:*
> TTL honzik:abc123...
```

### –ú–µ—Ç—Ä–∏–∫–∏

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:
- `honzik_cache_hit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à
- `honzik_greeting_cached` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π
- `honzik_response_generated` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç–≤–µ—Ç–æ–≤

## Rollback Plan

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git revert HEAD
git push

# –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à
# Railway ‚Üí Variables ‚Üí Add Variable:
CACHE_ENABLED=false
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ Web UI –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `0.0.0.0:3000`
‚úÖ –ö—ç—à–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
‚úÖ –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ—Ç–≤–µ—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚úÖ –≠–∫–æ–Ω–æ–º–∏—è OpenAI —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üöÄ
